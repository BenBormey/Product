@using WebApplication1.Models.Product
@model ProductIndexVM
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@inject Microsoft.Extensions.Localization.IStringLocalizer<SharedResource> T
@{
    ViewData["Title"] = "Products";
}
<style>
    .p-promo-slot {
        display: flex;
        align-items: center;
        gap: .25rem;
        padding: .25rem .5rem;
        border-radius: 10px;
        background: rgba(255, 99, 71, .06);
        border: 1px dashed rgba(255, 99, 71, .35);
    }

    .bg-danger-subtle {
        background: rgba(255, 99, 71, .15) !important;
    }
</style>



<div class="panel">
    <!-- Toolbar -->
    <div class="d-flex align-items-center gap-2 flex-wrap mb-3">
        <h2 class="panel-title m-0">Products</h2>
        <a asp-action="Create" class="btn btn-sm btn-primary">+ New</a>

        <!-- Filter bar -->
        <form method="get" class="ms-auto d-flex flex-wrap gap-2">
            <select asp-for="CategoryId" asp-items="Model.CategoryOptions"
                    class="form-select form-select-sm w-auto minw-200">
                <option value="">All categories</option>
            </select>

            <input name="q" value="@Model.Q" class="form-control form-control-sm w-auto minw-220" placeholder="Search by name..." />
            <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-search"></i> Filter</button>
            <a asp-action="Index" class="btn btn-sm btn-link">Reset</a>
        </form>
    </div>

    <!-- Category chips -->
    <ul class="nav nav-pills small mb-3 chips">
       
        @foreach (var opt in Model.CategoryOptions)
        {
            var active = (Model.CategoryId?.ToString() == opt.Value) ? "active" : "";
            <li class="nav-item">
                <a class="nav-link @active"
                   asp-action="Index"
                   asp-route-categoryId="@opt.Value"
                   asp-route-q="@Model.Q">@opt.Text</a>
            </li>
        }
    </ul>

    @if (Model.Items?.Any() != true)
    {
        <div class="empty">
            <div class="empty-icon">🍽️</div>
            <div class="empty-title">​@T["found"] </div>
            <p class="empty-sub">Try different filters or <a asp-action="Create">​@T["Add"]</a>.</p>
        </div>
    }
    else
    {
        <!-- Product grid -->
        <div class="product-grid">
            @foreach (var p in Model.Items)
            {
                <div class="p-card">
                    <div class="p-thumb">
                        <img src="@(string.IsNullOrWhiteSpace(p.Image) ? "/images/placeholder-food.jpg" : p.Image)" alt="@p.Name" loading="lazy" />
                        <span class="p-price">$ @p.Price.ToString("N2")</span>
                        <div class="p-promo-slot small mt-1">
                            <span class="badge bg-danger-subtle text-danger fw-semibold me-1">Promotion</span>
                            <span class="p-promo-value text-warning-emphasis">%@p.FinalPrice</span>
                        </div>

                        <div class="p-quick">
                            <a asp-action="Details" asp-route-id="@p.Id" class="btn btn-sm btn-light">​@T["Views"]</a>
                            <a asp-action="Edit" asp-route-id="@p.Id" class="btn btn-sm btn-warning">​@T["Edit"]Edit</a>
                            <a asp-action="Delete" asp-route-id="@p.Id" class="btn btn-sm btn-danger">​@T["Delete"]</a>
                        </div>
                    </div>

                    <div class="p-meta">
                        <div class="p-name" title="@p.Name">@p.Name</div>
                        <div class="p-sub">
                            <span class="badge bg-dark-subtle text-light">@p.CategoryName</span>
                            <form asp-controller="Cart" asp-action="Add" asp-route-id="@p.Id" method="post" class="ms-auto d-flex gap-2">
                                @Html.AntiForgeryToken()
                                <input type ="hidden" type="number" name="qty" value="1" min="1" class="form-control form-control-sm" style="width:80px" />
                                <button type="submit" class="btn btn-sm btn-primary">
                                    <i class="bi bi-cart-plus"></i> @T["AddCart"]
                                </button>
                            </form>

                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>
