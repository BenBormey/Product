@{
    ViewData["Title"] = "Report by Category";
    string from = Context.Request.Query["from"];
    string to = Context.Request.Query["to"];
    if (string.IsNullOrEmpty(from)) from = DateTime.Today.AddDays(-30).ToString("yyyy-MM-dd");
    if (string.IsNullOrEmpty(to)) to = DateTime.Today.ToString("yyyy-MM-dd");
}
<h3 class="mb-2">Report by Category</h3>
<form class="row g-2 mb-3" method="get">
    <div class="col-auto"><input class="form-control" type="date" name="from" value="@from" /></div>
    <div class="col-auto"><input class="form-control" type="date" name="to" value="@to" /></div>
    <div class="col-auto"><button class="btn btn-primary">Apply</button></div>
</form>

<div class="row g-3">
    <div class="col-lg-7">
        <table class="table table-dark table-sm" id="tbl">
            <thead><tr><th>Category</th><th class="text-end">Qty</th><th class="text-end">Revenue</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="col-lg-5"><canvas id="chart"></canvas></div>
</div>

@section Scripts {
    <script>
        (async function(){
          const from = new URLSearchParams(location.search).get('from') ?? '@from';
          const to   = new URLSearchParams(location.search).get('to')   ?? '@to';
          const data = await (await fetch(`/Reports/ByCategory?from=${from}&to=${to}`)).json();
          const tb = document.querySelector('#tbl tbody'); tb.innerHTML='';
          for (const r of data){
            tb.insertAdjacentHTML('beforeend',
              `<tr><td>${r.category}</td><td class="text-end">${r.quantity}</td><td class="text-end">$${r.revenue.toFixed(2)}</td></tr>`);
          }
          new Chart(document.getElementById('chart'), {
            type:'doughnut',
            data:{ labels: data.map(x=>x.category),
                   datasets:[{label:'Revenue', data: data.map(x=>x.revenue)}] },
            options:{ responsive:true }
          });
        })();
    </script>
}
