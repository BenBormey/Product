@{
    ViewData["Title"] = "Report by Product";
    string from = Context.Request.Query["from"];
    string to = Context.Request.Query["to"];
    if (string.IsNullOrEmpty(from)) from = DateTime.Today.AddDays(-30).ToString("yyyy-MM-dd");
    if (string.IsNullOrEmpty(to)) to = DateTime.Today.ToString("yyyy-MM-dd");
}
<h3 class="mb-2">Report by Product</h3>
<form class="row g-2 mb-3" method="get">
    <div class="col-auto"><input class="form-control" type="date" name="from" value="@from" /></div>
    <div class="col-auto"><input class="form-control" type="date" name="to" value="@to" /></div>
    <div class="col-auto"><button class="btn btn-primary">Apply</button></div>
</form>

<div class="row g-3">
    <div class="col-lg-7">
        <table class="table table-dark table-sm align-middle" id="tbl">
            <thead><tr><th>Product</th><th class="text-end">Qty</th><th class="text-end">Revenue</th></tr></thead>
            <tbody></tbody>
            <tfoot><tr class="fw-bold"><td>Total</td><td class="text-end" id="tQty">0</td><td class="text-end" id="tRev">$0</td></tr></tfoot>
        </table>
    </div>
    <div class="col-lg-5"><canvas id="chart"></canvas></div>
</div>

@section Scripts {
    <script>
        (async function(){
          const from = new URLSearchParams(location.search).get('from') ?? '@from';
          const to   = new URLSearchParams(location.search).get('to')   ?? '@to';
          const data = await (await fetch(`/Reports/ByProduct?from=${from}&to=${to}`)).json();

          const tb = document.querySelector('#tbl tbody');
          tb.innerHTML=''; let tQ=0,tR=0;
          for (const r of data){
            tQ+=r.quantity; tR+=r.revenue;
            tb.insertAdjacentHTML('beforeend',
              `<tr><td>${r.product}</td><td class="text-end">${r.quantity}</td><td class="text-end">$${r.revenue.toFixed(2)}</td></tr>`);
          }
          document.getElementById('tQty').textContent = tQ;
          document.getElementById('tRev').textContent = '$'+tR.toFixed(2);

          const top = data.slice(0,12);
          new Chart(document.getElementById('chart'), {
            type:'bar',
            data:{ labels: top.map(x=>x.product), datasets:[{label:'Revenue', data: top.map(x=>x.revenue)}] },
            options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
          });
        })();
    </script>
}
